<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ç©åˆ†(II) - 10.2 åƒæ•¸æ›²ç·šçš„å¾®ç©åˆ†</title>
    <script type="text/javascript">
        window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', 'Noto Sans TC', sans-serif;
            background-color: #fff7f9; /* Soft Pink */
            color: #5c524f; /* Muted Brown */
        }
        .font-zh { font-family: 'Noto Sans TC', sans-serif; }
        .font-en { font-family: 'Poppins', sans-serif; }
        .math-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5rem 0.25rem;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .math-display::-webkit-scrollbar { display: none; }
        .active-tab {
            background-color: #d8b4fe; /* Lavender */
            color: #4c1d95; /* Deep Purple */
            font-weight: 700;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .inactive-tab {
            background-color: #f3e8ff; /* Light Lavender */
            color: #6b21a8; /* Purple */
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .accordion-content.show { max-height: 2000px; }
        .rotate-180 { transform: rotate(180deg); }
        .text-justify { text-align: justify; }
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            pointer-events: none;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-container {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
            pointer-events: auto;
        }
        .modal-overlay.show .modal-container { transform: translate(-50%, -50%) scale(1); }
        .blinking-cursor {
            display: inline-block;
            width: 8px;
            height: 1.5rem;
            background-color: #5c524f;
            animation: blink 1s step-end infinite;
            margin-left: 2px;
        }
        @keyframes blink {
            from, to { background-color: transparent }
            50% { background-color: #5c524f; }
        }
    </style>
</head>
<body class="text-lg font-zh">

    <header class="bg-white/80 backdrop-blur-md shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex-shrink-0">
                    <h1 class="text-2xl font-bold text-purple-700 font-zh" data-i18n="header.title">
                        å¾®ç©åˆ†(II)é‡è£œä¿®ç­
                    </h1>
                    <p class="text-base text-stone-500 font-en" data-i18n="header.subtitle">æˆèª²è€å¸«:å³æ–‡éŠ“ (Prof. Wu Wen-Chuan)</p>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#concepts" class="text-stone-600 hover:bg-purple-200 hover:text-purple-800 px-3 py-2 rounded-md text-base font-medium" data-i18n="nav.concepts">æ ¸å¿ƒæ¦‚å¿µ</a>
                    <a href="#examples" class="text-stone-600 hover:bg-purple-200 hover:text-purple-800 px-3 py-2 rounded-md text-base font-medium" data-i18n="nav.examples">ç¯„ä¾‹èªªæ˜</a>
                    <a href="#practice" class="text-stone-600 hover:bg-purple-200 hover:text-purple-800 px-3 py-2 rounded-md text-base font-medium" data-i18n="nav.practice">è‡ªæˆ‘ç·´ç¿’</a>
                    <button id="api-key-modal-trigger" class="text-stone-500 hover:text-purple-600 transition-colors duration-200" title="Set AI API Key">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z"></path><circle cx="16.5" cy="7.5" r=".5"></circle></svg>
                    </button>
                    <button id="lang-toggle" class="bg-purple-100 text-purple-700 font-bold py-2 px-4 rounded-full w-28 text-center transition-all duration-300">
                        English
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-16">

        <section id="intro" class="text-center mb-20">
            <h2 class="text-4xl md:text-5xl font-bold text-purple-800 mb-4" data-i18n="main.title">10.2 åƒæ•¸æ›²ç·šçš„å¾®ç©åˆ†</h2>
            <p class="max-w-3xl mx-auto text-xl text-stone-600" data-i18n="main.subtitle">Calculus with Parametric Curves</p>
        </section>

        <section id="concepts" class="mb-20 scroll-mt-24">
            <h3 class="text-3xl md:text-4xl font-bold text-center mb-12 text-stone-700" data-i18n="concepts.title">ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¸å¿ƒæ¦‚å¿µ</h3>
            <div class="space-y-10">
                <div class="bg-white p-8 rounded-xl shadow-lg border border-stone-200">
                    <h4 class="text-2xl font-bold mb-4 text-purple-700" data-i18n="concepts.summary.title">ğŸ¤” èª²ç¨‹æ‘˜è¦</h4>
                    <p class="text-stone-600 text-justify" data-i18n="concepts.summary.p1"></p>
                    <ul class="list-disc list-inside mt-5 space-y-4 text-stone-600">
                        <li data-i18n-html="concepts.summary.l1"></li>
                        <li data-i18n-html="concepts.summary.l2"></li>
                        <li data-i18n-html="concepts.summary.l3"></li>
                    </ul>
                </div>
                <div class="bg-white p-8 rounded-xl shadow-lg border border-stone-200">
                    <h4 class="text-2xl font-bold mb-4 text-purple-700" data-i18n="concepts.objectives.title">ğŸ¯ å­¸ç¿’ç›®çš„</h4>
                     <ul class="list-disc list-inside space-y-3 text-stone-600">
                        <li class="text-justify" data-i18n="concepts.objectives.l1"></li>
                        <li class="text-justify" data-i18n="concepts.objectives.l2"></li>
                        <li class="text-justify" data-i18n="concepts.objectives.l3"></li>
                        <li class="text-justify" data-i18n="concepts.objectives.l4"></li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="examples" class="mb-16 scroll-mt-24">
            <h3 class="text-3xl md:text-4xl font-bold text-center mb-6 text-stone-700" data-i18n="examples.title">ç¬¬äºŒéƒ¨åˆ†ï¼šç¯„ä¾‹èªªæ˜</h3>
            <p class="text-center text-stone-600 max-w-3xl mx-auto mb-10 text-xl" data-i18n="examples.subtitle"></p>
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-8 border border-stone-200">
                <div id="example-tabs-container" class="flex flex-wrap gap-3 mb-8"></div>
                <div id="example-content-container"></div>
            </div>
        </section>

        <section id="practice" class="mb-16 scroll-mt-24">
            <div class="flex justify-center items-center gap-4 mb-6">
                <h3 class="text-3xl md:text-4xl font-bold text-stone-700" data-i18n="practice.title"></h3>
                <a href="Solution/10.2_solution.pdf" target="_blank" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-transform transform hover:scale-105 text-lg" data-i18n="practice.answerButton">ç­”æ¡ˆ</a>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 border border-stone-200 space-y-8">
                <div>
                    <h4 class="text-xl font-bold text-purple-700 mb-4" data-i18n-html="practice.q1_instruction"></h4>
                    <ol id="practice-list-1" class="space-y-2 text-stone-700 text-lg"></ol>
                </div>
                <div class="border-t pt-8">
                    <h4 class="text-xl font-bold text-purple-700 mb-4" data-i18n-html="practice.q2_instruction"></h4>
                    <ol id="practice-list-2" start="7" class="space-y-2 text-stone-700 text-lg"></ol>
                </div>
                <div class="border-t pt-8">
                    <h4 class="text-xl font-bold text-purple-700 mb-4" data-i18n-html="practice.q3_instruction"></h4>
                    <ol id="practice-list-3" start="11" class="space-y-2 text-stone-700 text-lg"></ol>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white/50 mt-16">
        <div class="container mx-auto px-8 py-6 text-center text-stone-500">
            <p data-i18n="footer.text">å¾®ç©åˆ†äº’å‹•æ•™å­¸</p>
        </div>
    </footer>

    <!-- Modals -->
    <div id="api-key-modal" class="modal-overlay">
        <div class="modal-container">
            <button id="api-key-modal-close" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            <div>
                <h3 class="text-2xl font-bold mb-4 text-stone-700" data-i18n="apiKeyModal.title"></h3>
                <p class="mb-4 text-stone-600" data-i18n="apiKeyModal.p1"></p>
                <input id="api-key-input" type="password" class="w-full px-4 py-3 rounded-md border-2 border-gray-300 focus:border-purple-500 focus:outline-none text-lg">
                <div class="flex justify-end gap-4 mt-6">
                    <button id="api-key-save" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-md shadow-md transition-transform transform hover:scale-105" data-i18n="apiKeyModal.save"></button>
                    <button id="api-key-modal-cancel" class="bg-stone-200 hover:bg-stone-300 text-stone-700 font-bold py-2 px-6 rounded-md shadow-md transition-transform transform hover:scale-105" data-i18n="apiKeyModal.cancel"></button>
                </div>
                 <p id="save-status" class="text-sm text-green-600 mt-2 h-4"></p>
            </div>
        </div>
    </div>
    
    <div id="ai-tutor-modal" class="modal-overlay">
        <div id="ai-tutor-modal-container" class="modal-container">
            <div id="ai-tutor-modal-header" class="w-full pb-4 border-b border-gray-200 cursor-move">
                 <h3 class="text-2xl font-bold text-purple-700" data-i18n="aiTutorModal.title"></h3>
            </div>
            <button id="ai-tutor-modal-close" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            <div id="ai-tutor-status" class="text-stone-700 leading-relaxed space-y-4 min-h-[50px] mt-4"></div>
            <audio id="ai-tutor-audio" class="w-full mt-4" controls></audio>
        </div>
    </div>

    <script>
    window.addEventListener('load', () => {
    
        // =================================================================
        // 1. è³‡æ–™èˆ‡ç‹€æ…‹ç®¡ç† (DATA & STATE MANAGEMENT)
        // =================================================================
        // æ‘˜è¦: æ­¤æ¨¡çµ„è² è²¬ç®¡ç†æ‡‰ç”¨ç¨‹å¼çš„ç‹€æ…‹ (ä¾‹å¦‚ç›®å‰çš„èªè¨€) 
        // ä»¥åŠå„²å­˜æ‰€æœ‰ç¯„ä¾‹å’Œ UI æ–‡æœ¬çš„è³‡æ–™ã€‚
        
        const AppState = {
            currentLanguage: 'zh', // 'zh' æˆ– 'en'
            activeExampleIndex: 0
        };

        const Translations = {
            zh: {
                header: {
                    title: "å¾®ç©åˆ†(II)é‡è£œä¿®ç­",
                    subtitle: "æˆèª²è€å¸«:å³æ–‡éŠ“ (Prof. Wu Wen-Chuan)"
                },
                nav: { concepts: "æ ¸å¿ƒæ¦‚å¿µ", examples: "ç¯„ä¾‹èªªæ˜", practice: "è‡ªæˆ‘ç·´ç¿’" },
                main: { title: "10.2 åƒæ•¸æ›²ç·šçš„å¾®ç©åˆ†", subtitle: "Calculus with Parametric Curves" },
                concepts: {
                    title: "ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¸å¿ƒæ¦‚å¿µ",
                    summary: {
                        title: "ğŸ¤” èª²ç¨‹æ‘˜è¦",
                        p1: "æœ¬ç« ç¯€æˆ‘å€‘å°‡å­¸ç¿’å¦‚ä½•å°‡å¾®ç©åˆ†çš„æ¦‚å¿µï¼ˆå¦‚å°æ•¸ã€é¢ç©ã€å¼§é•·ï¼‰æ‡‰ç”¨æ–¼åƒæ•¸æ–¹ç¨‹æ‰€å®šç¾©çš„æ›²ç·šã€‚é€™ä½¿æˆ‘å€‘èƒ½å¤ åˆ†æåƒæ•¸æ›²ç·šçš„å¹¾ä½•ç‰¹æ€§ï¼Œä¾‹å¦‚æ–œç‡å’Œå‡¹å‘æ€§ï¼Œä¸¦è¨ˆç®—å…¶æ‰€åœæˆçš„é¢ç©æˆ–è‡ªèº«çš„é•·åº¦ã€‚",
                        l1: "<b>åˆ‡ç·š (Tangents)</b><br>å°æ–¼åƒæ•¸æ›²ç·š $x=f(t), y=g(t)$ï¼Œå…¶åˆ‡ç·šæ–œç‡ $\\frac{dy}{dx}$ å¯ä»¥é€éé€£é–å¾‹æ±‚å¾—ï¼š$\\frac{dy}{dx} = \\frac{dy/dt}{dx/dt}$ï¼Œå‰ææ˜¯ $dx/dt \\neq 0$ã€‚æ°´å¹³åˆ‡ç·šç™¼ç”Ÿåœ¨ $dy/dt=0$ è™•ï¼Œè€Œå‚ç›´åˆ‡ç·šç™¼ç”Ÿåœ¨ $dx/dt=0$ è™•ã€‚",
                        l2: "<b>é¢ç© (Area)</b><br>è‹¥ä¸€æ¢åƒæ•¸æ›²ç·š $C$ ç”± $x=f(t), y=g(t), \\alpha \\le t \\le \\beta$ çµ¦å‡ºï¼Œä¸”æ›²ç·šåªè¢«æç¹ªä¸€æ¬¡ï¼Œå‰‡å…¶ä¸‹æ–¹èˆ‡ x è»¸æ‰€åœæˆçš„é¢ç©ç‚º $A = \\int_a^b y \\, dx = \\int_\\alpha^\\beta g(t) f'(t) \\, dt$ã€‚",
                        l3: "<b>å¼§é•· (Arc Length)</b><br>åƒæ•¸æ›²ç·š $C$ å¾ $t=\\alpha$ åˆ° $t=\\beta$ çš„å¼§é•·å¯ä»¥é€éç©åˆ†è¨ˆç®—ï¼š$L = \\int_\\alpha^\\beta \\sqrt{(\\frac{dx}{dt})^2 + (\\frac{dy}{dt})^2} \\, dt$ã€‚"
                    },
                    objectives: {
                        title: "ğŸ¯ å­¸ç¿’ç›®çš„",
                        l1: "è¨ˆç®—åƒæ•¸æ›²ç·šåœ¨æŸä¸€é»çš„åˆ‡ç·šæ–œç‡ã€‚",
                        l2: "æ±‚å‡ºåƒæ•¸æ›²ç·šçš„æ°´å¹³åˆ‡ç·šèˆ‡å‚ç›´åˆ‡ç·šæ‰€åœ¨çš„ä½ç½®ã€‚",
                        l3: "ä½¿ç”¨ç©åˆ†è¨ˆç®—ç”±åƒæ•¸æ›²ç·šæ‰€åœæˆçš„å€åŸŸé¢ç©ã€‚",
                        l4: "ä½¿ç”¨ç©åˆ†è¨ˆç®—åƒæ•¸æ›²ç·šçš„å¼§é•·ã€‚"
                    }
                },
                examples: {
                    title: "ç¬¬äºŒéƒ¨åˆ†ï¼šç¯„ä¾‹èªªæ˜",
                    subtitle: "è«‹é¸æ“‡é¡Œå‹ç¯„ä¾‹ã€‚æ¯å€‹ç¯„ä¾‹éƒ½å°‡å¼•å°æ‚¨å®Œæˆå¾ã€Œè§€å¯Ÿåˆ†æã€åˆ°ã€Œè§£é¡Œã€çš„å®Œæ•´æµç¨‹ã€‚",
                    analysisTitle: "è§€å¯Ÿèˆ‡åˆ†æï¼š",
                    stepsTitle: "è§£é¡Œæ­¥é©Ÿï¼š",
                    aiTutorButton: "AIåŠ©æ•™è§£èªª"
                },
                practice: {
                    title: "ç¬¬ä¸‰éƒ¨åˆ†ï¼šè‡ªæˆ‘ç·´ç¿’ (èª²æœ¬)",
                    answerButton: "ç­”æ¡ˆ",
                    q1_instruction: "æ±‚ $\\frac{dx}{dt}, \\frac{dy}{dt}, \\text{ and } \\frac{dy}{dx}$",
                    q1_instruction_plain: "æ±‚åƒæ•¸æ›²ç·šçš„å°æ•¸ dx/dt, dy/dt, å’Œ dy/dx:",
                    q2_instruction: "æ±‚åœ¨æŒ‡å®šåƒæ•¸å€¼æ™‚çš„åˆ‡ç·šæ–¹ç¨‹å¼",
                    q2_instruction_plain: "æ±‚åƒæ•¸æ›²ç·šåœ¨æŒ‡å®šåƒæ•¸å€¼æ™‚çš„åˆ‡ç·šæ–¹ç¨‹å¼:",
                    q3_instruction: "ç”¨å…©ç¨®æ–¹æ³•æ±‚åœ¨æŒ‡å®šé»çš„åˆ‡ç·šæ–¹ç¨‹å¼",
                    q3_instruction_plain: "ç”¨å…©ç¨®æ–¹æ³•æ±‚åƒæ•¸æ›²ç·šåœ¨æŒ‡å®šé»çš„åˆ‡ç·šæ–¹ç¨‹å¼:",
                    copyButtonTitle: "è¤‡è£½é¡Œç›®",
                    copied: "å·²è¤‡è£½ï¼",
                    problems1: [
                        "$x = 2t^3 + 3t, y = 4t - 5t^2$",
                        "$x = t - \\ln t, y = t^2 - t^{-2}$",
                        "$x = te^t, y = t + \\sin t$",
                        "$x = t + \\sin(t^2+2), y = \\tan(t^2+2)$"
                    ],
                    problems2: [
                        "$x = t^3 + 1, y = t^4 + t; \\quad t = -1$",
                        "$x = \\sqrt{t}, y = t^2 - 2t; \\quad t = 4$",
                        "$x = \\sin 2t + \\cos t, y = \\cos 2t - \\sin t; \\quad t = \\pi$",
                        "$x = e^t \\sin \\pi t, y = e^{2t}; \\quad t=0$"
                    ],
                    problems3: [
                        "$x = \\sin t, y = \\cos^2 t; \\quad (\\frac{1}{2}, \\frac{3}{4})$",
                        "$x = \\sqrt{t+4}, y = 1/(t+4); \\quad (2, \\frac{1}{4})$"
                    ]
                },
                footer: { text: "å¾®ç©åˆ†äº’å‹•æ•™å­¸" },
                apiKeyModal: {
                    title: "è¨­å®š Google AI Studio API Key",
                    p1: "è«‹è¼¸å…¥æ‚¨çš„ API Key ä»¥å•Ÿç”¨ AI åŠ©æ•™åŠŸèƒ½ã€‚æ‚¨çš„ Key å°‡åªæœƒå„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­ã€‚",
                    save: "å„²å­˜",
                    cancel: "å–æ¶ˆ"
                },
                aiTutorModal: { title: "AI åŠ©æ•™èªéŸ³è§£èªª" }
            },
            en: {
                header: {
                    title: "Calculus (II)",
                    subtitle: "Instructor: Prof. Wu Wen-Chuan"
                },
                nav: { concepts: "Core Concepts", examples: "Examples", practice: "Practice" },
                main: { title: "10.2 Calculus with Parametric Curves", subtitle: "åƒæ•¸æ›²ç·šçš„å¾®ç©åˆ†" },
                concepts: {
                    title: "Part 1: Core Concepts",
                    summary: {
                        title: "ğŸ¤” Lesson Summary",
                        p1: "In this section, we will learn how to apply calculus concepts (like derivatives, area, and arc length) to curves defined by parametric equations. This allows us to analyze the geometric properties of parametric curves, such as slope and concavity, and to calculate the area they enclose or their own length.",
                        l1: "<b>Tangents</b><br>For a parametric curve $x=f(t), y=g(t)$, the slope of the tangent line $dy/dx$ can be found using the Chain Rule: $\\frac{dy}{dx} = \\frac{dy/dt}{dx/dt}$, provided that $dx/dt \\neq 0$. Horizontal tangents occur where $dy/dt=0$, and vertical tangents occur where $dx/dt=0$.",
                        l2: "<b>Area</b><br>If a curve $C$ is given by $x=f(t), y=g(t), \\alpha \\le t \\le \\beta$, and is traced only once, the area under it from x=a to x=b is $A = \\int_a^b y \\, dx = \\int_\\alpha^\\beta g(t) f'(t) \\, dt$.",
                        l3: "<b>Arc Length</b><br>The arc length of a parametric curve $C$ from $t=\\alpha$ to $t=\\beta$ can be calculated by an integral: $L = \\int_\\alpha^\\beta \\sqrt{(\\frac{dx}{dt})^2 + (\\frac{dy}{dt})^2} \\, dt$."
                    },
                    objectives: {
                        title: "ğŸ¯ Learning Objectives",
                        l1: "Calculate the slope of the tangent line to a parametric curve at a given point.",
                        l2: "Find the points where a parametric curve has horizontal and vertical tangents.",
                        l3: "Use integration to find the area of a region enclosed by a parametric curve.",
                        l4: "Use integration to find the arc length of a parametric curve."
                    }
                },
                examples: {
                    title: "Part 2: Examples",
                    subtitle: "Select an example. Each one will guide you through the complete process from 'Analysis' to 'Solution'.",
                    analysisTitle: "Observation & Analysis:",
                    stepsTitle: "Solution Steps:",
                    aiTutorButton: "AI Tutor Explanation"
                },
                practice: {
                    title: "Part 3: Self Practice (Textbook)",
                    answerButton: "Solution",
                    q1_instruction: "Find $\\frac{dx}{dt}, \\frac{dy}{dt}, \\text{ and } \\frac{dy}{dx}$",
                    q1_instruction_plain: "Find dx/dt, dy/dt, and dy/dx for the parametric curve:",
                    q2_instruction: "Find an equation of the tangent to the curve at the point corresponding to the given value of the parameter.",
                    q2_instruction_plain: "Find an equation of the tangent to the curve at the point corresponding to the given value of the parameter:",
                    q3_instruction: "Find an equation of the tangent to the curve at the given point by two methods.",
                    q3_instruction_plain: "Find an equation of the tangent to the curve at the given point by two methods:",
                    copyButtonTitle: "Copy problem",
                    copied: "Copied!",
                     problems1: [
                        "$x = 2t^3 + 3t, y = 4t - 5t^2$",
                        "$x = t - \\ln t, y = t^2 - t^{-2}$",
                        "$x = te^t, y = t + \\sin t$",
                        "$x = t + \\sin(t^2+2), y = \\tan(t^2+2)$"
                    ],
                    problems2: [
                        "$x = t^3 + 1, y = t^4 + t; \\quad t = -1$",
                        "$x = \\sqrt{t}, y = t^2 - 2t; \\quad t = 4$",
                        "$x = \\sin 2t + \\cos t, y = \\cos 2t - \\sin t; \\quad t = \\pi$",
                        "$x = e^t \\sin \\pi t, y = e^{2t}; \\quad t=0$"
                    ],
                    problems3: [
                        "$x = \\sin t, y = \\cos^2 t; \\quad (\\frac{1}{2}, \\frac{3}{4})$",
                        "$x = \\sqrt{t+4}, y = 1/(t+4); \\quad (2, \\frac{1}{4})$"
                    ]
                },
                footer: { text: "Interactive Calculus Tutorial" },
                apiKeyModal: {
                    title: "Set Google AI Studio API Key",
                    p1: "Please enter your API Key to enable the AI Tutor feature. Your key will be stored only in your browser.",
                    save: "Save",
                    cancel: "Cancel"
                },
                aiTutorModal: { title: "AI Tutor Voice Explanation" }
            }
        };
        
        const ExamplesData = [
            {
                title: { zh: 'å°‹æ‰¾åˆ‡ç·šèˆ‡å‡¹æ€§', en: 'Finding Tangents and Concavity'},
                problem: { zh: 'ä¸€æ›²ç·š C ç”±åƒæ•¸æ–¹ç¨‹ $x = t^2, y = t^3 - 3t$ å®šç¾©ã€‚ (a) è­‰æ˜ C åœ¨é» (3, 0) æœ‰å…©æ¢åˆ‡ç·šä¸¦æ±‚å…¶æ–¹ç¨‹å¼ã€‚ (b) æ‰¾å‡º C ä¸Šåˆ‡ç·šç‚ºæ°´å¹³æˆ–å‚ç›´çš„é»ã€‚(c) åˆ¤æ–·æ›²ç·šåœ¨ä½•è™•ç‚ºå‡¹å‘ä¸Šæˆ–å‡¹å‘ä¸‹ã€‚(d) æç¹ªæ›²ç·šã€‚', en: 'A curve C is defined by the parametric equations $x = t^2, y = t^3 - 3t$. (a) Show that C has two tangents at the point (3, 0) and find their equations. (b) Find the points on C where the tangent is horizontal or vertical. (c) Determine where the curve is concave upward or downward. (d) Sketch the curve.'},
                source: 'p.674 Example 1',
                analysis: {
                    zh: 'é¦–å…ˆï¼Œæˆ‘å€‘éœ€è¦è¨ˆç®—å°æ•¸ $\\frac{dy}{dx}$ ä»¥æ±‚å¾—æ–œç‡ã€‚å°æ–¼å‡¹æ€§ï¼Œæˆ‘å€‘éœ€è¦è¨ˆç®—äºŒéšå°æ•¸ $\\frac{d^2y}{dx^2}$ã€‚æ°´å¹³åˆ‡ç·šç™¼ç”Ÿåœ¨ $\\frac{dy}{dt}=0$ æ™‚ï¼Œå‚ç›´åˆ‡ç·šç™¼ç”Ÿåœ¨ $\\frac{dx}{dt}=0$ æ™‚ã€‚æœ€å¾Œï¼Œç¶œåˆæ‰€æœ‰è³‡è¨Šä¾†æç¹ªæ›²ç·šã€‚',
                    en: 'First, we need to calculate the derivative $\\frac{dy}{dx}$ to find the slope. For concavity, we need the second derivative, $\\frac{d^2y}{dx^2}$. Horizontal tangents occur when $\\frac{dy}{dt}=0$ and vertical tangents occur when $\\frac{dx}{dt}=0$. Finally, we combine all this information to sketch the curve.'
                },
                steps: [
                    {
                        title: { zh: 'æ­¥é©Ÿ 1ï¼šè¨ˆç®—ä¸€éšå°æ•¸', en: 'Step 1: Find the First Derivative'},
                        content: { zh: `æˆ‘å€‘æœ‰ $\\frac{dx}{dt} = 2t$ å’Œ $\\frac{dy}{dt} = 3t^2 - 3$ã€‚å› æ­¤ï¼Œåˆ‡ç·šæ–œç‡ç‚ºï¼š $$\\frac{dy}{dx} = \\frac{dy/dt}{dx/dt} = \\frac{3t^2 - 3}{2t}$$`, en: `We have $\\frac{dx}{dt} = 2t$ and $\\frac{dy}{dt} = 3t^2 - 3$. Therefore, the slope of the tangent is: $$\\frac{dy}{dx} = \\frac{dy/dt}{dx/dt} = \\frac{3t^2 - 3}{2t}$$` }
                    },
                    {
                        title: { zh: 'æ­¥é©Ÿ 2ï¼šè™•ç†é» (3, 0) çš„åˆ‡ç·š', en: 'Step 2: Find Tangents at point (3, 0)' },
                        content: { zh: `ç•¶é»ç‚º $(3, 0)$ æ™‚ï¼Œ$x=t^2=3$ çµ¦å‡º $t = \\pm\\sqrt{3}$ã€‚é€™å…©å€‹ $t$ å€¼éƒ½æ»¿è¶³ $y=0$ã€‚å› æ­¤ï¼Œæ›²ç·šåœ¨ $(3,0)$ è™•è‡ªäº¤ã€‚<br>ç•¶ $t=\\sqrt{3}$ï¼Œæ–œç‡ç‚º $\\frac{dy}{dx} = \\sqrt{3}$ã€‚åˆ‡ç·šæ–¹ç¨‹å¼ç‚º $y = \\sqrt{3}(x-3)$ã€‚ <br>ç•¶ $t=-\\sqrt{3}$ï¼Œæ–œç‡ç‚º $\\frac{dy}{dx} = -\\sqrt{3}$ã€‚åˆ‡ç·šæ–¹ç¨‹å¼ç‚º $y = -\\sqrt{3}(x-3)$ã€‚`, en: `When the point is $(3, 0)$, $x=t^2=3$ gives $t = \\pm\\sqrt{3}$. Both $t$ values satisfy $y=0$. Thus, the curve crosses itself at $(3,0)$.<br>For $t=\\sqrt{3}$, the slope is $\\frac{dy}{dx} = \\sqrt{3}$. The tangent line is $y = \\sqrt{3}(x-3)$. <br>For $t=-\\sqrt{3}$, the slope is $\\frac{dy}{dx} = -\\sqrt{3}$. The tangent line is $y = -\\sqrt{3}(x-3)$.` }
                    },
                    {
                        title: { zh: 'æ­¥é©Ÿ 3ï¼šå°‹æ‰¾æ°´å¹³èˆ‡å‚ç›´åˆ‡ç·š', en: 'Step 3: Find Horizontal and Vertical Tangents' },
                        content: { 
                            zh: `<b>æ°´å¹³åˆ‡ç·š:</b> $\\frac{dy}{dt} = 3t^2 - 3 = 0 \\implies t = \\pm 1$ã€‚å°æ‡‰çš„é»æ˜¯ $(1, -2)$ å’Œ $(1, 2)$ã€‚<br><b>å‚ç›´åˆ‡ç·š:</b> $\\frac{dx}{dt} = 2t = 0 \\implies t = 0$ã€‚å°æ‡‰çš„é»æ˜¯ $(0, 0)$ã€‚`,
                            en: `<b>Horizontal Tangents:</b> $\\frac{dy}{dt} = 3t^2 - 3 = 0 \\implies t = \\pm 1$. The corresponding points are $(1, -2)$ and $(1, 2)$.<br><b>Vertical Tangents:</b> $\\frac{dx}{dt} = 2t = 0 \\implies t = 0$. The corresponding point is $(0, 0)$.`
                        }
                    },
                    {
                        title: { zh: 'æ­¥é©Ÿ 4ï¼šåˆ¤æ–·å‡¹æ€§ä¸¦æç¹ªæ›²ç·š', en: 'Step 4: Determine Concavity and Sketch' },
                        content: { 
                            zh: `ç‚ºäº†æ‰¾å‡ºå‡¹æ€§ï¼Œæˆ‘å€‘è¨ˆç®—äºŒéšå°æ•¸ï¼š $$\\frac{d^2y}{dx^2} = \\frac{\\frac{d}{dt}(\\frac{dy}{dx})}{\\frac{dx}{dt}} = \\frac{\\frac{3(t^2+1)}{2t^2}}{2t} = \\frac{3(t^2+1)}{4t^3}$$ ç•¶ $t>0$ æ™‚ï¼Œæ›²ç·šå‡¹å‘ä¸Šã€‚ç•¶ $t<0$ æ™‚ï¼Œæ›²ç·šå‡¹å‘ä¸‹ã€‚
                            <img src="10.2_1.png" alt="åœ–1" class="mx-auto max-w-sm">`,
                            en: `To find concavity, we compute the second derivative: $$\\frac{d^2y}{dx^2} = \\frac{\\frac{d}{dt}(\\frac{dy}{dx})}{\\frac{dx}{dt}} = \\frac{\\frac{3(t^2+1)}{2t^2}}{2t} = \\frac{3(t^2+1)}{4t^3}$$ The curve is concave upward when $t>0$ and concave downward when $t<0$.
                            <img src="10.2_1.png" alt="åœ–1" class="mx-auto max-w-sm">`
                        }
                    }
                ]
            },
            {
                title: { zh: 'æ“ºç·šä¸‹çš„é¢ç©', en: 'Area under a Cycloid'},
                problem: { zh: 'æ±‚æ“ºç·š $x = r(\\theta - \\sin\\theta), y = r(1 - \\cos\\theta)$ ä¸€æ‹±ä¸‹æ–¹çš„é¢ç©ã€‚', en: 'Find the area under one arch of the cycloid $x = r(\\theta - \\sin\\theta), y = r(1 - \\cos\\theta)$.'},
                source: 'p.675 Example 3',
                analysis: {
                    zh: 'æ“ºç·šçš„ä¸€æ‹±æ˜¯ç”±åƒæ•¸ $\\theta$ å¾ $0$ èµ°åˆ° $2\\pi$ æç¹ªå‡ºä¾†çš„ã€‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨é¢ç©å…¬å¼ $A = \\int y \\, dx$ã€‚æˆ‘å€‘éœ€è¦å°‡æ‰€æœ‰è®Šæ•¸éƒ½ç”¨åƒæ•¸ $\\theta$ ä¾†è¡¨ç¤ºï¼ŒåŒ…æ‹¬ $dx$ å’Œç©åˆ†çš„ä¸Šä¸‹é™ã€‚',
                    en: 'One arch of the cycloid is traced as the parameter $\\theta$ goes from $0$ to $2\\pi$. We can use the area formula $A = \\int y \\, dx$. We need to express everything, including $dx$ and the limits of integration, in terms of the parameter $\\theta$.'
                },
                steps: [
                    {
                        title: { zh: 'æ­¥é©Ÿ 1ï¼šè¨­å®šç©åˆ†', en: 'Step 1: Set up the Integral' },
                        content: { zh: `æˆ‘å€‘æœ‰ $y = r(1 - \\cos\\theta)$ ä¸” $dx = \\frac{dx}{d\\theta}d\\theta = r(1 - \\cos\\theta)d\\theta$ã€‚ç•¶ $\\theta$ å¾ $0$ å¢åŠ åˆ° $2\\pi$ æ™‚ï¼Œ$x$ å¾ $0$ å¢åŠ åˆ° $2\\pi r$ã€‚å› æ­¤ï¼Œé¢ç©ç‚ºï¼š $$A = \\int_{x=0}^{x=2\\pi r} y \\, dx = \\int_{\\theta=0}^{\\theta=2\\pi} r(1 - \\cos\\theta) \\cdot r(1 - \\cos\\theta) \\, d\\theta$$`, en: `We have $y = r(1 - \\cos\\theta)$ and $dx = \\frac{dx}{d\\theta}d\\theta = r(1 - \\cos\\theta)d\\theta$. As $\\theta$ increases from $0$ to $2\\pi$, $x$ increases from $0$ to $2\\pi r$. So the area is: $$A = \\int_{x=0}^{x=2\\pi r} y \\, dx = \\int_{\\theta=0}^{\\theta=2\\pi} r(1 - \\cos\\theta) \\cdot r(1 - \\cos\\theta) \\, d\\theta$$` }
                    },
                    {
                        title: { zh: 'æ­¥é©Ÿ 2ï¼šè¨ˆç®—ç©åˆ†', en: 'Step 2: Evaluate the Integral' },
                        content: { 
                            zh: `$$A = r^2 \\int_0^{2\\pi} (1 - 2\\cos\\theta + \\cos^2\\theta) \\, d\\theta$$ ä½¿ç”¨åŠè§’å…¬å¼ $\\cos^2\\theta = \\frac{1}{2}(1+\\cos(2\\theta))$: $$A = r^2 \\int_0^{2\\pi} \\left(1 - 2\\cos\\theta + \\frac{1}{2}(1+\\cos(2\\theta))\\right) \\, d\\theta$$ $$A = r^2 \\left[\\frac{3}{2}\\theta - 2\\sin\\theta + \\frac{1}{4}\\sin(2\\theta)\\right]_0^{2\\pi} = r^2 \\left( \\frac{3}{2}(2\\pi) \\right) = 3\\pi r^2$$
                            <img src="10.2_2.png" alt="åœ–2" class="mx-auto max-w-sm">`,
                            en: `$$A = r^2 \\int_0^{2\\pi} (1 - 2\\cos\\theta + \\cos^2\\theta) \\, d\\theta$$ Using the half-angle identity $\\cos^2\\theta = \\frac{1}{2}(1+\\cos(2\\theta))$: $$A = r^2 \\int_0^{2\\pi} \\left(1 - 2\\cos\\theta + \\frac{1}{2}(1+\\cos(2\\theta))\\right) \\, d\\theta$$ $$A = r^2 \\left[\\frac{3}{2}\\theta - 2\\sin\\theta + \\frac{1}{4}\\sin(2\\theta)\\right]_0^{2\\pi} = r^2 \\left( \\frac{3}{2}(2\\pi) \\right) = 3\\pi r^2$$
                            <img src="10.2_2.png" alt="åœ–2" class="mx-auto max-w-sm">`
                        }
                    }
                ]
            },
            {
                title: { zh: 'æ“ºç·šçš„å¼§é•·', en: 'Arc Length of a Cycloid' },
                problem: { zh: 'æ±‚æ“ºç·š $x = r(\\theta - \\sin\\theta), y = r(1 - \\cos\\theta)$ ä¸€æ‹±çš„å¼§é•·ã€‚', en: 'Find the length of one arch of the cycloid $x = r(\\theta - \\sin\\theta), y = r(1 - \\cos\\theta)$.' },
                source: 'p.678 Example 5',
                analysis: {
                    zh: 'æ“ºç·šçš„ä¸€æ‹±å°æ‡‰æ–¼åƒæ•¸å€é–“ $0 \\le \\theta \\le 2\\pi$ã€‚æˆ‘å€‘éœ€è¦è¨ˆç®— $\\frac{dx}{d\\theta}$ å’Œ $\\frac{dy}{d\\theta}$ï¼Œç„¶å¾Œä»£å…¥å¼§é•·å…¬å¼ $L = \\int_0^{2\\pi} \\sqrt{(\\frac{dx}{d\\theta})^2 + (\\frac{dy}{d\\theta})^2} \\, d\\theta$ã€‚',
                    en: 'One arch of the cycloid corresponds to the parameter interval $0 \\le \\theta \\le 2\\pi$. We need to find $\\frac{dx}{d\\theta}$ and $\\frac{dy}{d\\theta}$ and plug them into the arc length formula $L = \\int_0^{2\\pi} \\sqrt{(\\frac{dx}{d\\theta})^2 + (\\frac{dy}{d\\theta})^2} \\, d\\theta$.'
                },
                steps: [
                     {
                        title: { zh: 'æ­¥é©Ÿ 1ï¼šè¨ˆç®—å°æ•¸å¹³æ–¹å’Œ', en: 'Step 1: Find the Sum of Squared Derivatives' },
                        content: { zh: `$\\frac{dx}{d\\theta} = r(1 - \\cos\\theta)$ å’Œ $\\frac{dy}{d\\theta} = r\\sin\\theta$ã€‚ <br> $$(\\frac{dx}{d\\theta})^2 + (\\frac{dy}{d\\theta})^2 = r^2(1 - 2\\cos\\theta + \\cos^2\\theta) + r^2\\sin^2\\theta$$ $$= r^2(1 - 2\\cos\\theta + 1) = 2r^2(1 - \\cos\\theta)$$`, 
                                 en: `$\\frac{dx}{d\\theta} = r(1 - \\cos\\theta)$ and $\\frac{dy}{d\\theta} = r\\sin\\theta$. <br> $$(\\frac{dx}{d\\theta})^2 + (\\frac{dy}{d\\theta})^2 = r^2(1 - 2\\cos\\theta + \\cos^2\\theta) + r^2\\sin^2\\theta$$ $$= r^2(1 - 2\\cos\\theta + 1) = 2r^2(1 - \\cos\\theta)$$` }
                    },
                    {
                        title: { zh: 'æ­¥é©Ÿ 2ï¼šè¨ˆç®—å¼§é•·ç©åˆ†', en: 'Step 2: Evaluate the Arc Length Integral' },
                        content: { zh: `ä½¿ç”¨åŠè§’å…¬å¼ $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$ï¼Œæˆ‘å€‘å¾—åˆ° $(\\frac{dx}{d\\theta})^2 + (\\frac{dy}{d\\theta})^2 = 4r^2\\sin^2(\\theta/2)$ã€‚å› æ­¤ï¼Œ $$L = \\int_0^{2\\pi} \\sqrt{4r^2\\sin^2(\\theta/2)} \\, d\\theta = \\int_0^{2\\pi} 2r|\\sin(\\theta/2)| \\, d\\theta$$ åœ¨ $0 \\le \\theta \\le 2\\pi$ å€é–“ï¼Œ$\\sin(\\theta/2) \\ge 0$ï¼Œæ‰€ä»¥çµ•å°å€¼å¯ä»¥å»æ‰ã€‚ $$L = 2r \\int_0^{2\\pi} \\sin(\\theta/2) \\, d\\theta = 2r[-2\\cos(\\theta/2)]_0^{2\\pi}$$ $$L = -4r(\\cos\\pi - \\cos 0) = -4r(-1 - 1) = 8r$$
                                        <img src="10.2_3.png" alt="åœ–3" class="mx-auto max-w-sm">`, 
                                 en: `Using the half-angle identity $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$, we get $(\\frac{dx}{d\\theta})^2 + (\\frac{dy}{d\\theta})^2 = 4r^2\\sin^2(\\theta/2)$. Therefore, $$L = \\int_0^{2\\pi} \\sqrt{4r^2\\sin^2(\\theta/2)} \\, d\\theta = \\int_0^{2\\pi} 2r|\\sin(\\theta/2)| \\, d\\theta$$ On the interval $0 \\le \\theta \\le 2\\pi$, $\\sin(\\theta/2) \\ge 0$, so we can remove the absolute value. $$L = 2r \\int_0^{2\\pi} \\sin(\\theta/2) \\, d\\theta = 2r[-2\\cos(\\theta/2)]_0^{2\\pi}$$ $$L = -4r(\\cos\\pi - \\cos 0) = -4r(-1 - 1) = 8r$$
                                        <img src="10.2_3.png" alt="åœ–3" class="mx-auto max-w-sm">` }
                    }
                ]
            },
            {
                title: { zh: 'æ—‹è½‰é«”çš„è¡¨é¢ç©', en: 'Surface Area of Revolution' },
                problem: { zh: 'è­‰æ˜åŠå¾‘ç‚º r çš„çƒé«”è¡¨é¢ç©ç‚º $4\\pi r^2$ã€‚', en: 'Show that the surface area of a sphere of radius r is $4\\pi r^2$.' },
                source: 'p.678 Example 7',
                analysis: {
                    zh: 'æˆ‘å€‘å¯ä»¥é€éå°‡ä¸€å€‹åŠåœ“ç¹å…¶ç›´å¾‘æ—‹è½‰ä¾†å¾—åˆ°ä¸€å€‹çƒé«”ã€‚åŠåœ“å¯ä»¥ç”±åƒæ•¸æ–¹ç¨‹ $x = r\\cos t, y = r\\sin t$ for $0 \\le t \\le \\pi$ è¡¨ç¤ºã€‚ç„¶å¾Œæˆ‘å€‘ä½¿ç”¨åƒæ•¸æ›²ç·šçš„æ—‹è½‰é«”è¡¨é¢ç©å…¬å¼ã€‚',
                    en: 'We can obtain a sphere by rotating a semicircle about its diameter. A semicircle can be represented by the parametric equations $x = r\\cos t, y = r\\sin t$ for $0 \\le t \\le \\pi$. We then use the formula for the surface area of revolution for parametric curves.'
                },
                steps: [
                     {
                        title: { zh: 'æ­¥é©Ÿ 1ï¼šè¨­å®šç©åˆ†', en: 'Step 1: Set up the Integral' },
                        content: { zh: `æˆ‘å€‘æœ‰ $\\frac{dx}{dt} = -r\\sin t$ å’Œ $\\frac{dy}{dt} = r\\cos t$ã€‚ <br> $(\\frac{dx}{dt})^2 + (\\frac{dy}{dt})^2 = r^2\\sin^2 t + r^2\\cos^2 t = r^2$ã€‚ <br>è¡¨é¢ç©å…¬å¼ç‚º $S = \\int_0^\\pi 2\\pi y \\sqrt{(\\frac{dx}{dt})^2 + (\\frac{dy}{dt})^2} \\, dt$ã€‚ <br> $$S = \\int_0^\\pi 2\\pi(r\\sin t) \\sqrt{r^2} \\, dt = 2\\pi r^2 \\int_0^\\pi \\sin t \\, dt$$`, 
                                 en: `We have $\\frac{dx}{dt} = -r\\sin t$ and $\\frac{dy}{dt} = r\\cos t$. <br> $(\\frac{dx}{dt})^2 + (\\frac{dy}{dt})^2 = r^2\\sin^2 t + r^2\\cos^2 t = r^2$. <br>The surface area formula is $S = \\int_0^\\pi 2\\pi y \\sqrt{(\\frac{dx}{dt})^2 + (\\frac{dy}{dt})^2} \\, dt$. <br> $$S = \\int_0^\\pi 2\\pi(r\\sin t) \\sqrt{r^2} \\, dt = 2\\pi r^2 \\int_0^\\pi \\sin t \\, dt$$` }
                    },
                    {
                        title: { zh: 'æ­¥é©Ÿ 2ï¼šè¨ˆç®—ç©åˆ†', en: 'Step 2: Evaluate the Integral' },
                        content: { zh: `$$S = 2\\pi r^2 [-\\cos t]_0^\\pi = 2\\pi r^2 ( -\\cos\\pi - (-\\cos 0) ) $$ $$ S = 2\\pi r^2 ( -(-1) - (-1) ) = 2\\pi r^2(2) = 4\\pi r^2$$`, 
                                 en: `$$S = 2\\pi r^2 [-\\cos t]_0^\\pi = 2\\pi r^2 ( -\\cos\\pi - (-\\cos 0) ) $$ $$ S = 2\\pi r^2 ( -(-1) - (-1) ) = 2\\pi r^2(2) = 4\\pi r^2$$` }
                    }
                ]
            }
        ];
        
        // =================================================================
        // 2. UI æ¸²æŸ“æ¨¡çµ„ (UI RENDERING MODULE)
        // =================================================================
        // æ‘˜è¦: æ­¤æ¨¡çµ„è² è²¬æ‰€æœ‰ DOM æ“ä½œï¼ŒåŒ…æ‹¬æ ¹æ“šç›®å‰çš„èªè¨€æ¸²æŸ“é ç±¤ã€
        // ç¯„ä¾‹å…§å®¹ä»¥åŠæ›´æ–°éœæ…‹æ–‡æœ¬ã€‚
        
        const UIRenderer = {
            async init() {
                this.updateAllText(AppState.currentLanguage);
                this.renderTabs(AppState.currentLanguage);
                this.renderExampleContent(AppState.activeExampleIndex, AppState.currentLanguage);
                this.renderPracticeProblems(AppState.currentLanguage);
                await MathJax.typesetPromise();
            },
            
            updateAllText(lang) {
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.dataset.i18n;
                    const translation = key.split('.').reduce((obj, k) => obj && obj[k], Translations[lang]);
                    if (translation) {
                        el.textContent = translation;
                    }
                });
                
                 document.querySelectorAll('[data-i18n-html]').forEach(el => {
                    const key = el.dataset.i18nHtml;
                    const translation = key.split('.').reduce((obj, k) => obj && obj[k], Translations[lang]);
                    if (translation) {
                        el.innerHTML = translation;
                    }
                });
                
                // æ›´æ–°ç‰¹å®šå…ƒç´ ï¼Œå¦‚ placeholder
                const apiKeyInput = document.getElementById('api-key-input');
                apiKeyInput.placeholder = lang === 'zh' ? 'è«‹åœ¨æ­¤è¼¸å…¥ API Key' : 'Enter API Key here';
            },

            renderTabs(lang) {
                const container = document.getElementById('example-tabs-container');
                container.innerHTML = ExamplesData.map((ex, i) => {
                    const title = ex.title[lang] || ex.title['en'];
                    return `<button data-index="${i}" class="tab-button text-base sm:text-lg py-3 px-5 rounded-lg transition duration-300 ${i === AppState.activeExampleIndex ? 'active-tab' : 'inactive-tab'}">${title}</button>`;
                }).join('');

                container.querySelectorAll('.tab-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const newIndex = parseInt(e.currentTarget.dataset.index);
                        AppState.activeExampleIndex = newIndex;
                        this.renderTabs(lang);
                        this.renderExampleContent(newIndex, lang);
                    });
                });
            },

            async renderExampleContent(index, lang) {
                const container = document.getElementById('example-content-container');
                const example = ExamplesData[index];
                const t = Translations[lang].examples;

                const stepsHtml = example.steps.map((step, i) => `
                    <div class="border-b border-stone-200 last:border-b-0">
                        <button class="accordion-header w-full text-left p-5 focus:outline-none hover:bg-purple-50 transition duration-300 flex justify-between items-center">
                            <span class="font-semibold text-lg text-stone-700">${step.title[lang]}</span>
                            <svg class="w-6 h-6 text-purple-600 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-5 bg-stone-50 border-t border-stone-200 text-stone-600 leading-relaxed math-display">${step.content[lang]}</div>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = `
                    <div class="mb-8">
                        <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4">
                             <h4 class="text-2xl font-bold text-stone-800">${example.title[lang]}</h4>
                             <button id="ai-tutor-button" data-index="${index}" class="ai-tutor-btn flex items-center justify-center gap-2 bg-purple-500 text-white font-bold py-3 px-5 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 disabled:bg-gray-400 disabled:opacity-70 disabled:cursor-not-allowed">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
                                 <span>${t.aiTutorButton}</span>
                             </button>
                        </div>
                        <div class="p-5 bg-amber-100/70 rounded-lg text-xl math-display">${example.problem[lang]}</div>
                        ${example.source ? `<p class="mt-2 text-base text-stone-500 text-right font-en">${example.source}</p>` : ''}
                    </div>
                    <div class="mb-8">
                        <h4 class="text-2xl font-bold text-stone-800 mb-3">${t.analysisTitle}</h4>
                        <p class="p-5 bg-sky-100/70 rounded-lg text-stone-600">${example.analysis[lang]}</p>
                    </div>
                    <div>
                        <h4 class="text-2xl font-bold text-stone-800 mb-3">${t.stepsTitle}</h4>
                        <div class="border border-stone-200 rounded-lg overflow-hidden">${stepsHtml}</div>
                    </div>
                `;
                
                this.attachEventListeners();
                // è§¸ç™¼ MathJax é‡æ–°æ¸²æŸ“æ–°çš„å…§å®¹
                await MathJax.typesetPromise();
            },
            
            renderPracticeProblems(lang) {
                const t = Translations[lang].practice;
                if (!document.getElementById('practice')) return; 

                const list1Info = { el: document.getElementById('practice-list-1'), problems: t.problems1, instruction: t.q1_instruction_plain };
                const list2Info = { el: document.getElementById('practice-list-2'), problems: t.problems2, instruction: t.q2_instruction_plain };
                const list3Info = { el: document.getElementById('practice-list-3'), problems: t.problems3, instruction: t.q3_instruction_plain };
                
                const copyIconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;

                [list1Info, list2Info, list3Info].forEach(listInfo => {
                    if (listInfo.el) {
                        // Clear existing list items before re-rendering
                        listInfo.el.innerHTML = ''; 
                        listInfo.problems.forEach((problem, index) => {
                            const cleanProblem = problem.replace(/\$/g, '').replace(/<[^>]*>/g, '').replace(/\\quad/g, ' ').replace(/\\/g, '');
                            const copyText = `${listInfo.instruction} ${cleanProblem}`;
                            
                            const li = document.createElement('li');
                            li.className = 'flex justify-between items-center group py-1';
                            
                            // Get the original number if the list has a 'start' attribute
                            const itemNumber = (listInfo.el.start || 1) + index;
                            
                            li.innerHTML = `
                                <span class="flex items-center">
                                    <span class="mr-2 font-bold">${itemNumber}.</span>
                                    <span>${problem.replace(/<[^>]*>/g, '')}</span>
                                </span>
                                <span class="copy-container relative">
                                    <button data-copy-text="${copyText}" class="copy-btn p-1 rounded-md hover:bg-purple-100" title="${t.copyButtonTitle}">
                                        ${copyIconSvg}
                                    </button>
                                </span>`;
                            listInfo.el.appendChild(li);
                        });
                    }
                });
            },

            attachEventListeners() {
                // æ‰‹é¢¨ç´ (Accordion) é‚è¼¯
                document.querySelectorAll('#example-content-container .accordion-header').forEach(header => {
                    header.addEventListener('click', () => {
                        header.nextElementSibling.classList.toggle('show');
                        header.querySelector('svg').classList.toggle('rotate-180');
                    });
                });
                
                // AI åŠ©æ•™æŒ‰éˆ•é‚è¼¯
                const aiTutorButton = document.getElementById('ai-tutor-button');
                const apiKey = localStorage.getItem('googleApiKey');
                if (!apiKey) {
                    aiTutorButton.disabled = true;
                    aiTutorButton.title = AppState.currentLanguage === 'zh' ? 'è«‹å…ˆè¨­å®š API Key' : 'Please set API Key first';
                }
                aiTutorButton.addEventListener('click', (e) => {
                    AITutor.handleRequest(e.currentTarget.dataset.index, AppState.currentLanguage);
                });
            }
        };

        // =================================================================
        // 3. å½ˆå‡ºè¦–çª—ç®¡ç†æ¨¡çµ„ (MODAL MANAGEMENT MODULE)
        // =================================================================
        // æ‘˜è¦: è™•ç†æ‰€æœ‰èˆ‡å½ˆå‡ºè¦–çª—ç›¸é—œçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬é–‹å•Ÿã€é—œé–‰ï¼Œ
        // ä»¥åŠè®“è¦–çª—å¯æ‹–å‹•ã€‚
        
        const ModalManager = {
            init() {
                this.apiKeyModal = document.getElementById('api-key-modal');
                this.aiTutorModal = document.getElementById('ai-tutor-modal');
                
                this.setupModal(this.apiKeyModal, 'api-key-modal-trigger', 'api-key-modal-close');
                this.setupModal(this.aiTutorModal, null, 'ai-tutor-modal-close');
                
                document.getElementById('api-key-modal-cancel').addEventListener('click', () => this.apiKeyModal.classList.remove('show'));
                document.getElementById('api-key-save').addEventListener('click', this.saveApiKey.bind(this));

                this.makeDraggable(document.getElementById('ai-tutor-modal-container'), document.getElementById('ai-tutor-modal-header'));
            },

            setupModal(modal, triggerId, closeButtonId) {
                const trigger = document.getElementById(triggerId);
                const closeBtn = document.getElementById(closeButtonId);
                
                const openModal = () => modal.classList.add('show');
                const closeModal = () => {
                    modal.classList.remove('show');
                    if (modal.id === 'ai-tutor-modal') {
                        const audioPlayer = document.getElementById('ai-tutor-audio');
                        audioPlayer.pause();
                        audioPlayer.currentTime = 0;
                    }
                };

                if (trigger) trigger.addEventListener('click', openModal);
                if (closeBtn) closeBtn.addEventListener('click', closeModal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal();
                });
            },
            
            saveApiKey() {
                const apiKeyInput = document.getElementById('api-key-input');
                const saveStatus = document.getElementById('save-status');
                const key = apiKeyInput.value.trim();
                
                if (key) {
                    localStorage.setItem('googleApiKey', key);
                    saveStatus.textContent = AppState.currentLanguage === 'zh' ? 'API Key å·²å„²å­˜ï¼' : 'API Key saved!';
                } else {
                    localStorage.removeItem('googleApiKey');
                    saveStatus.textContent = AppState.currentLanguage === 'zh' ? 'API Key å·²æ¸…é™¤ã€‚' : 'API Key cleared.';
                }
                
                UIRenderer.renderExampleContent(AppState.activeExampleIndex, AppState.currentLanguage);
                setTimeout(() => {
                    this.apiKeyModal.classList.remove('show');
                    saveStatus.textContent = '';
                }, 1000);
            },
            
            makeDraggable(modal, header) {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                header.onmousedown = (e) => {
                    e.preventDefault();
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = () => { document.onmouseup = null; document.onmousemove = null; };
                    document.onmousemove = (ev) => {
                        ev.preventDefault();
                        pos1 = pos3 - ev.clientX;
                        pos2 = pos4 - ev.clientY;
                        pos3 = ev.clientX;
                        pos4 = ev.clientY;
                        modal.style.top = (modal.offsetTop - pos2) + "px";
                        modal.style.left = (modal.offsetLeft - pos1) + "px";
                        modal.style.transform = 'none'; 
                    };
                };
            }
        };

        // =================================================================
        // 4. AI åŠ©æ•™æ¨¡çµ„ (AI TUTOR MODULE)
        // =================================================================
        // æ‘˜è¦: æ­¤æ¨¡çµ„è™•ç†æ‰€æœ‰èˆ‡ Google AI API çš„äº’å‹•ï¼ŒåŒ…æ‹¬ç”Ÿæˆ
        // æ–‡å­—è§£é‡‹ä¸¦å°‡å…¶è½‰æ›ç‚ºèªéŸ³ã€‚
        
        const AITutor = {
            async handleRequest(index, lang) {
                const apiKey = localStorage.getItem('googleApiKey');
                if (!apiKey) return;
                
                const example = ExamplesData[index];
                const stepsText = example.steps.map(s => `${s.title[lang]}:\n${s.content[lang].replace(/<br>/g, '\n').replace(/<[^>]*>/g, '')}`).join('\n\n');
                const prompt = `Problem:\n${example.problem[lang].replace(/<[^>]*>/g, '')}\n\nAnalysis:\n${example.analysis[lang]}\n\nSolution Steps:\n${stepsText}`;
                
                const systemPrompt = lang === 'zh'
                    ? "ä½ æ˜¯ä¸€ä½è¦ªåˆ‡çš„å¾®ç©åˆ†åŠ©æ•™ã€‚è«‹ç”¨ç°¡å–®æ˜“æ‡‚ã€å£èªåŒ–çš„æ–¹å¼ï¼Œè§£èªªä»¥ä¸‹çš„å¾®ç©åˆ†é¡Œç›®ã€‚è«‹å…ˆè§£é‡‹è§£é¡Œçš„æ€è·¯ï¼Œç„¶å¾Œé€æ­¥èªªæ˜è§£é¡Œéç¨‹ã€‚"
                    : "You are a friendly calculus tutor. Explain the following calculus problem in a simple, conversational way. First, explain the overall thinking process, then walk through the solution steps.";

                this.generateExplanation(prompt, systemPrompt, apiKey);
            },
            
            async _fetchWithRetry(url, options, maxRetries = 4) {
                let lastError;
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (response.ok) {
                            return response;
                        }
                        // Only retry on server errors or rate limiting
                        if (response.status === 429 || response.status >= 500) {
                            lastError = new Error(`API request failed with status ${response.status}`);
                        } else {
                            // Don't retry on other client errors (e.g., 400 Bad Request)
                            const errorBody = await response.text();
                            throw new Error(`API request failed with status ${response.status}: ${errorBody}`);
                        }
                    } catch (error) {
                        lastError = error;
                    }
                    // Wait with exponential backoff and jitter
                    if (i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 500;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
                throw lastError;
            },

            async generateExplanation(prompt, systemPrompt, apiKey) {
                const statusEl = document.getElementById('ai-tutor-status');
                const audioEl = document.getElementById('ai-tutor-audio');
                const modal = document.getElementById('ai-tutor-modal');
                
                // é‡è¨­ä¸¦é¡¯ç¤ºå½ˆå‡ºè¦–çª—
                const modalContainer = document.getElementById('ai-tutor-modal-container');
                modalContainer.style.top = '50%';
                modalContainer.style.left = '50%';
                modalContainer.style.transform = 'translate(-50%, -50%)';
                statusEl.innerHTML = `<p>${AppState.currentLanguage === 'zh' ? 'AI åŠ©æ•™æ€è€ƒä¸­...' : 'AI Tutor is thinking...'}<span class="blinking-cursor"></span></p>`;
                audioEl.src = '';
                audioEl.hidden = true;
                modal.classList.add('show');
                
                const textApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const ttsApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

                try {
                    const textPayload = {
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    };
                    const textResponse = await this._fetchWithRetry(textApiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(textPayload) });
                    const textResult = await textResponse.json();
                    const explanationText = textResult.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!explanationText) throw new Error('Could not get valid text content from API.');
                    
                    statusEl.innerHTML = `<p>${AppState.currentLanguage === 'zh' ? 'æ­£åœ¨ç‚ºæ‚¨ç”¢ç”ŸèªéŸ³...' : 'Generating audio for you...'}<span class="blinking-cursor"></span></p>`;
                    
                    const ttsPayload = {
                        contents: [{ parts: [{ text: explanationText }] }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Sadaltager" } } }
                        }
                    };
                    const audioResponse = await this._fetchWithRetry(ttsApiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(ttsPayload) });
                    const audioResult = await audioResponse.json();
                    const audioData = audioResult?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                    const mimeType = audioResult?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/")) {
                        const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                        const pcmData = this._base64ToArrayBuffer(audioData);
                        const wavBlob = this._pcmToWav(new Int16Array(pcmData), sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        
                        statusEl.innerHTML = `<p>${AppState.currentLanguage === 'zh' ? 'èªéŸ³è§£èªªå·²å°±ç·’ï¼' : 'Voice explanation is ready!'}</p>`;
                        audioEl.src = audioUrl;
                        audioEl.hidden = false;
                        audioEl.play();
                    } else {
                        throw new Error('Could not get valid audio content from API.');
                    }
                } catch (error) {
                    console.error("AI Tutor Error:", error);
                    statusEl.innerHTML = `<p class="text-red-600">${AppState.currentLanguage === 'zh' ? 'æŠ±æ­‰ï¼ŒAI åŠ©æ•™å‡ºäº†ä¸€é»å•é¡Œï¼š' : 'Sorry, the AI tutor ran into an issue:'}<br>${error.message}</p><p class="text-sm mt-2">${AppState.currentLanguage === 'zh' ? 'è«‹ç¢ºèªæ‚¨çš„ API Key æ˜¯å¦æ­£ç¢ºä¸”æœ‰è¶³å¤ çš„æ¬Šé™ã€‚' : 'Please check if your API Key is correct and has sufficient permissions.'}</p>`;
                }
            },
            
            _base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes.buffer;
            },

            _pcmToWav(pcmData, sampleRate) {
                const dataSize = pcmData.length * 2;
                const buffer = new ArrayBuffer(44 + dataSize);
                const view = new DataView(buffer);
                view.setUint32(0, 0x52494646, false); // "RIFF"
                view.setUint32(4, 36 + dataSize, true);
                view.setUint32(8, 0x57415645, false); // "WAVE"
                view.setUint32(12, 0x666d7420, false); // "fmt "
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true);
                view.setUint16(22, 1, true); // numChannels
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, sampleRate * 2, true); // byteRate
                view.setUint16(32, 2, true); // blockAlign
                view.setUint16(34, 16, true); // bitsPerSample
                view.setUint32(36, 0x64617461, false); // "data"
                view.setUint32(40, dataSize, true);
                let offset = 44;
                for (let i = 0; i < pcmData.length; i++, offset += 2) {
                    view.setInt16(offset, pcmData[i], true);
                }
                return new Blob([view], { type: 'audio/wav' });
            }
        };

        // =================================================================
        // 5. æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ– (APPLICATION INITIALIZATION)
        // =================================================================
        // æ‘˜è¦: é€™æ˜¯æ‡‰ç”¨ç¨‹å¼çš„ä¸»è¦é€²å…¥é»ã€‚å®ƒæœƒåˆå§‹åŒ–æ‰€æœ‰æ¨¡çµ„ä¸¦
        // è¨­å®šåˆå§‹çš„äº‹ä»¶ç›£è½å™¨ã€‚
        
        async function main() {
            const langToggleButton = document.getElementById('lang-toggle');
            
            langToggleButton.addEventListener('click', async () => {
                AppState.currentLanguage = AppState.currentLanguage === 'zh' ? 'en' : 'zh';
                langToggleButton.textContent = AppState.currentLanguage === 'zh' ? 'English' : 'ç¹é«”ä¸­æ–‡';
                
                document.documentElement.lang = AppState.currentLanguage === 'zh' ? 'zh-Hant' : 'en';

                // æ­£ç¢ºåœ°ç®¡ç† body çš„ class ä»¥åˆ‡æ›å­—é«”æ¨£å¼
                document.body.classList.remove('font-zh', 'font-en');
                if (AppState.currentLanguage === 'zh') {
                    document.body.classList.add('font-zh');
                } else {
                    document.body.classList.add('font-en');
                }

                await UIRenderer.init();
            });

            // åˆå§‹è¨­å®š
            ModalManager.init();
            await UIRenderer.init();

            // ç‚ºç·´ç¿’å€å¡Šè¨­å®šè¤‡è£½äº‹ä»¶ç›£è½å™¨
            function copyToClipboard(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.top = '-9999px';
                textArea.style.left = '-9999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                } catch (err) {
                    console.error('ç„¡æ³•è¤‡è£½é¡Œç›®:', err);
                }
                document.body.removeChild(textArea);
            }

            const practiceSection = document.getElementById('practice');
            if (practiceSection) {
                practiceSection.addEventListener('click', function(e) {
                    const copyBtn = e.target.closest('.copy-btn');
                    if (copyBtn) {
                        const textToCopy = copyBtn.dataset.copyText;
                        copyToClipboard(textToCopy);

                        // Visual feedback
                        const lang = AppState.currentLanguage;
                        const copiedText = Translations[lang].practice.copied;
                        const originalTitle = Translations[lang].practice.copyButtonTitle;
                        const checkIconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-green-500"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
                        const originalIcon = copyBtn.innerHTML;

                        copyBtn.innerHTML = checkIconSvg;
                        copyBtn.title = copiedText;
                        copyBtn.disabled = true;

                        setTimeout(() => {
                            copyBtn.innerHTML = originalIcon;
                            copyBtn.title = originalTitle;
                            copyBtn.disabled = false;
                        }, 1500);
                    }
                });
            }
        }

        main();
    });
    </script>
</body>
</html>


